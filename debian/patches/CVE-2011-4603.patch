Description: fix SILC remote crash
#
#
# patch "libpurple/protocols/silc/ops.c"
#  from [80bd9a7d3faf9e5ef28438647159fe19847e9839]
#    to [e828291021afbdd6e6370738aa6224788bf885a3]
#
============================================================
--- pidgin/libpurple/protocols/silc/ops.c	80bd9a7d3faf9e5ef28438647159fe19847e9839
+++ pidgin/libpurple/protocols/silc/ops.c	e828291021afbdd6e6370738aa6224788bf885a3
@@ -332,10 +332,17 @@ silc_channel_message(SilcClient client, 
 	}
 
 	if (flags & SILC_MESSAGE_FLAG_UTF8) {
-		tmp = g_markup_escape_text((const char *)message, -1);
+		const char *msg = (const char *)message;
+		char *salvaged = NULL;
+		if (!g_utf8_validate((const char *)message, -1, NULL)) {
+			salvaged = purple_utf8_salvage((const char *)message);
+			msg = salvaged;
+		}
+		tmp = g_markup_escape_text(msg, -1);
 		/* Send to Purple */
 		serv_got_chat_in(gc, purple_conv_chat_get_id(PURPLE_CONV_CHAT(convo)),
 				 sender->nickname, 0, tmp, time(NULL));
+		g_free(salvaged);
 		g_free(tmp);
 	}
 }
